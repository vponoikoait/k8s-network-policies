# LEVEL 14 - Lifecycle-Aware Policies
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: pod-phase-restrictions
spec:
  podSelector:
    matchLabels:
      state: ephemeral
  # Restrict traffic during initialization
  policyTypes: ["Egress"]
  egress:
  - to:
    - ipBlock:
        cidr: 169.254.169.254/32         # Cloud metadata service
    ports:
    - port: 80
      protocol: TCP
    when:
      podPhase: "Pending"                 # Experimental feature 